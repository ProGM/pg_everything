{
	"name": "Ubuntu with PostgreSQL",
	"image": "mcr.microsoft.com/devcontainers/base:noble",
	"features": {
		"ghcr.io/devcontainers/features/common-utils:2": {},
		// "ghcr.io/devcontainer-community/devcontainer-features/asdf-vm.com:1": {},
		"./local-features/postgresql": {
			"version": "17"
		},
		"./local-features/postgresql-extensions": {
			"version": "17"
		},
		"./local-features/asdf": {
			"version": "latest"
		}
	},

	// Forward PostgreSQL port and your application port
	"forwardPorts": [5432, 54321, 8080, 8081],

    "mounts": [
    //   "source=asdf-cache,target=/home/root/.asdf,type=volume",
		"source=pg-extensions,target=/home/root/extensions,type=volume"
    ],

	// Install extensions and configure PostgreSQL after container creation
	"postCreateCommand": ".devcontainer/setup.sh",

	// Configure tool-specific properties
	"customizations": {
		"vscode": {
			"extensions": [
				"ms-ossdata.vscode-postgresql"
			]
		}
	},

	// Set environment variables for PostgreSQL
	"containerEnv": {
		"POSTGRES_PASSWORD": "postgres",
		"POSTGRES_USER": "postgres",
		"POSTGRES_DB": "postgres"
	},

	// Uncomment to connect as root instead. More info: https://aka.ms/dev-containers-non-root.
	"remoteUser": "root",

	"runArgs": [
		"--cap-add=SYS_PTRACE",
		"--security-opt","seccomp=unconfined",
		"--security-opt","apparmor=unconfined",
		"--ulimit","core=-1",
		"--env-file", ".env.devcontainer"
	]
}
